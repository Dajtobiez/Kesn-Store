<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thanh To√°n - KesnStore</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
  <header class="bg-white shadow p-4 flex justify-between items-center flex-col md:flex-row">
    <a href="/" class="mb-2 md:mb-0">
      <img src="images/logo.png" alt="KesnStore" class="h-10 md:h-12">
    </a>
    <nav class="flex items-center gap-4">
      <a href="#" class="text-gray-600 hover:text-black">S·∫£n ph·∫©m</a>
      <a href="#" class="text-gray-600 hover:text-black">Gi·ªõi thi·ªáu</a>
      <a href="#" class="text-gray-600 hover:text-black">Li√™n h·ªá</a>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg grid grid-cols-1 md:grid-cols-2 gap-6">
    <section>
      <h2 class="text-2xl font-semibold mb-4">Th√¥ng tin giao h√†ng</h2>
      <form class="space-y-4">
        <input type="text" id="fullName" placeholder="H·ªç v√† t√™n" class="w-full border rounded px-4 py-2">
        <input type="tel" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" class="w-full border rounded px-4 py-2">
        <input type="email" id="email" placeholder="Email (n·∫øu c√≥)" class="w-full border rounded px-4 py-2">
        <select id="province" class="w-full border rounded px-4 py-2 mt-2"></select>
        <select id="district" class="w-full border rounded px-4 py-2 mt-2" disabled></select>
        <select id="ward" class="w-full border rounded px-4 py-2 mt-2" disabled></select>
        <div class="relative">
          <input type="text" id="autocomplete-input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ (s·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£...)" class="w-full border rounded px-4 py-2 mt-2">
          <div id="autocomplete" class="hidden"></div>
        </div>
        <textarea id="note" placeholder="Ghi ch√∫ (t√πy ch·ªçn)" class="w-full border rounded px-4 py-2" rows="3"></textarea>
        <h2 class="text-xl font-semibold mt-6 mb-2">Ph∆∞∆°ng th·ª©c thanh to√°n</h2>
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
  <label class="border rounded-lg p-4 flex flex-col items-center text-center cursor-pointer hover:shadow-md transition group">
    <input type="radio" name="payment" value="cod" class="hidden peer" checked>
    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mb-2 group-hover:bg-gray-200">
      üíµ
    </div>
    <span class="text-sm font-semibold peer-checked:text-green-600">Thanh to√°n khi nh·∫≠n h√†ng</span>
  </label>

  <label class="border rounded-lg p-4 flex flex-col items-center text-center cursor-pointer hover:shadow-md transition group">
    <input type="radio" name="payment" value="bank" class="hidden peer">
    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mb-2 group-hover:bg-gray-200">
      üè¶
    </div>
    <span class="text-sm font-semibold peer-checked:text-green-600">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
  </label>

  <label class="border rounded-lg p-4 flex flex-col items-center text-center cursor-pointer hover:shadow-md transition group">
    <input type="radio" name="payment" value="wallet" class="hidden peer">
    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mb-2 group-hover:bg-gray-200">
      üì±
    </div>
    <span class="text-sm font-semibold peer-checked:text-green-600">V√≠ ƒëi·ªán t·ª≠ (Momo, ZaloPay)</span>
  </label>
</div>

      </form>
    </section>
    <section class="bg-gray-50 p-6 rounded-lg border flex flex-col">
      <h2 class="text-2xl font-semibold mb-4">T√≥m t·∫Øt ƒë∆°n h√†ng</h2>
      <div class="text-right mb-6">
        <div class="flex justify-between text-sm text-gray-600">
          <span>T·∫°m t√≠nh</span><span id="subtotal">0‚Ç´</span>
        </div>
        <div class="flex justify-between text-sm text-gray-600">
          <span>Ph√≠ v·∫≠n chuy·ªÉn</span><span>Mi·ªÖn ph√≠</span>
        </div>
        <div class="flex justify-between text-sm text-green-600 font-semibold hidden" id="discount-row">
          <span>Gi√° sau gi·∫£m</span>
          <span id="discounted-total">0‚Ç´</span>
        </div>
        <div class="flex justify-between font-bold text-lg mt-2">
          <span>T·ªïng c·ªông</span>
          <span id="total">0‚Ç´</span>
        </div>
      </div>
      <div class="space-y-4 overflow-y-auto max-h-64 mb-4" id="product-list"></div>
      <div class="flex gap-2 mt-4">
        <input type="text" placeholder="M√£ gi·∫£m gi√°" id="voucher-code" class="flex-1 border rounded px-3 py-2">
        <button onclick="applyVoucher()" class="bg-gray-800 text-white px-4 rounded hover:bg-gray-700">√Åp d·ª•ng</button>
      </div>
      <button onclick="placeOrder()" class="mt-6 w-full bg-black text-white py-3 rounded-lg text-lg font-semibold hover:bg-gray-800 transition">
        ƒê·∫∑t h√†ng
      </button>
    </section>
  </main>

  <footer class="mt-10 text-center text-sm text-gray-500 pb-6">
    ¬© 2025 KesnStore. Design by Dajtobiez.
  </footer>

   <script>
    const products = [
      { name: "JA 2 EP", price: 4100000, qty: 2, size: "44.5", color: "ƒê·ªè", image: "images/sanpham1.png" },
      { name: "KD18 EP", price: 3600000, qty: 1, size: "43", color: "ƒêen", image: "images/sanpham2.png" },
    ];

    let streetAddress = "";

    function initAutocomplete() {
      const input = document.getElementById("autocomplete-input");
      const autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: "vn" },
        fields: ["address_components", "formatted_address"],
        types: ["geocode"],
      });

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.address_components) {
          alert("Vui l√≤ng ch·ªçn ƒë·ªãa ch·ªâ h·ª£p l·ªá.");
          return;
        }

        let street = "", ward = "", district = "", province = "";
        place.address_components.forEach(component => {
          const types = component.types;
          if (types.includes("route") || types.includes("street_number")) street += component.long_name + " ";
          else if (types.includes("sublocality") || types.includes("sublocality_level_1")) ward = component.long_name;
          else if (types.includes("locality") || types.includes("administrative_area_level_2")) district = component.long_name;
          else if (types.includes("administrative_area_level_1")) province = component.long_name;
        });

        streetAddress = street.trim();
        input.value = streetAddress || place.formatted_address;
        updateDropdowns(province, district, ward);
      });
    }

    function renderProducts() {
      const container = document.getElementById("product-list");
      let subtotal = 0;
      container.innerHTML = "";
      products.forEach(p => {
        const item = document.createElement("div");
        item.className = "flex gap-4 items-center";
        item.innerHTML = `
          <img src="${p.image}" class="w-16 h-16 rounded object-cover">
          <div class="flex-1">
            <p class="font-semibold">${p.name}</p>
            <p class="text-sm text-gray-500">Size: ${p.size} | M√†u: ${p.color}</p>
            <p class="text-sm text-gray-500">S·ªë l∆∞·ª£ng: ${p.qty}</p>
          </div>
          <p class="font-bold text-right">${(p.price * p.qty).toLocaleString()}‚Ç´</p>
        `;
        container.appendChild(item);
        subtotal += p.price * p.qty;
      });
      document.getElementById("subtotal").innerText = subtotal.toLocaleString() + "‚Ç´";
      document.getElementById("total").innerText = subtotal.toLocaleString() + "‚Ç´";
    }

    function applyVoucher() {
      const code = document.getElementById("voucher-code").value.trim();
      const discount = code === "GIAM10" ? 0.1 : 0;
      const subtotal = products.reduce((sum, p) => sum + p.price * p.qty, 0);
      if (discount > 0) {
        const discountedTotal = subtotal * (1 - discount);
        document.getElementById("subtotal").innerText = subtotal.toLocaleString() + "‚Ç´";
        document.getElementById("subtotal").classList.add("line-through", "text-red-500");
        document.getElementById("discounted-total").innerText = discountedTotal.toLocaleString() + "‚Ç´";
        document.getElementById("discount-row").classList.remove("hidden");
        document.getElementById("total").innerText = discountedTotal.toLocaleString() + "‚Ç´";
        alert("√Åp d·ª•ng m√£ th√†nh c√¥ng!");
      } else {
        alert("M√£ kh√¥ng h·ª£p l·ªá.");
      }
    }

    function placeOrder() {
      const fullName = document.getElementById("fullName").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const province = document.getElementById("province").value;
      const district = document.getElementById("district").value;
      const ward = document.getElementById("ward").value;
      const note = document.getElementById("note").value.trim();

      if (!fullName) return alert("Vui l√≤ng nh·∫≠p h·ªç v√† t√™n.");
      if (!phone || !/^\d{10}$/.test(phone)) return alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá (10 ch·ªØ s·ªë).");
      if (!streetAddress) return alert("Vui l√≤ng ch·ªçn ƒë·ªãa ch·ªâ (s·ªë nh√†, t√™n ƒë∆∞·ªùng).");
      if (!province || !district || !ward) return alert("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß T·ªânh/Th√†nh, Qu·∫≠n/Huy·ªán, Ph∆∞·ªùng/X√£.");

      const orderData = {
        fullName,
        phone,
        email,
        address: {
          street: streetAddress,
          ward: document.getElementById("ward").options[document.getElementById("ward").selectedIndex]?.text || "",
          district: document.getElementById("district").options[document.getElementById("district").selectedIndex]?.text || "",
          province: document.getElementById("province").options[document.getElementById("province").selectedIndex]?.text || ""
        },
        note,
        payment: document.querySelector("input[name='payment']:checked").value || "",
        products
      };
      console.log("ƒê∆°n h√†ng:", JSON.stringify(orderData));
      alert("ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t. C·∫£m ∆°n b·∫°n!");
    }

    function normalizeName(name) {
      return name?.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().replace("thanh pho ", "").replace("tinh ", "") || "";
    }

    async function fetchProvinces() {
      try {
        const res = await fetch("https://provinces.open-api.vn/api/p/");
        const provinces = await res.json();
        const select = document.getElementById("province");
        select.innerHTML = "<option disabled selected>-- Ch·ªçn T·ªânh/Th√†nh --</option>";
        provinces.forEach(p => select.innerHTML += `<option value="${p.code}">${p.name}</option>`);
        select.disabled = false;
      } catch (error) {
        alert("L·ªói l·∫•y danh s√°ch t·ªânh/th√†nh.");
      }
    }

    async function fetchDistricts(provinceId) {
      try {
        const res = await fetch(`https://provinces.open-api.vn/api/p/${provinceId}?depth=2`);
        const data = await res.json();
        const districts = data.districts;
        const select = document.getElementById("district");
        select.innerHTML = "<option disabled selected>-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>";
        districts.forEach(d => select.innerHTML += `<option value="${d.code}">${d.name}</option>`);
        select.disabled = false;
      } catch (error) {
        alert("L·ªói l·∫•y danh s√°ch qu·∫≠n/huy·ªán.");
      }
    }

    async function fetchWards(districtId) {
      try {
        const res = await fetch(`https://provinces.open-api.vn/api/d/${districtId}?depth=2`);
        const data = await res.json();
        const wards = data.wards;
        const select = document.getElementById("ward");
        select.innerHTML = "<option disabled selected>-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>";
        wards.forEach(w => select.innerHTML += `<option value="${w.code}">${w.name}</option>`);
        select.disabled = false;
      } catch (error) {
        alert("L·ªói l·∫•y danh s√°ch ph∆∞·ªùng/x√£.");
      }
    }

    async function updateDropdowns(provinceName, districtName, wardName) {
      try {
        const res = await fetch("https://provinces.open-api.vn/api/p/");
        const provinces = await res.json();
        const provinceSelect = document.getElementById("province");
        provinceSelect.innerHTML = "<option disabled selected>-- Ch·ªçn T·ªânh/Th√†nh --</option>";
        provinces.forEach(p => {
          const option = document.createElement("option");
          option.value = p.code;
          option.text = p.name;
          if (normalizeName(p.name) === normalizeName(provinceName)) option.selected = true;
          provinceSelect.appendChild(option);
        });
        provinceSelect.disabled = false;

        if (provinceName) {
          const selectedProvince = provinces.find(p => normalizeName(p.name) === normalizeName(provinceName));
          if (selectedProvince) {
            const res = await fetch(`https://provinces.open-api.vn/api/p/${selectedProvince.code}?depth=2`);
            const data = await res.json();
            const districts = data.districts;
            const districtSelect = document.getElementById("district");
            districtSelect.innerHTML = "<option disabled selected>-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>";
            districts.forEach(d => {
              const option = document.createElement("option");
              option.value = d.code;
              option.text = d.name;
              if (normalizeName(d.name) === normalizeName(districtName)) option.selected = true;
              districtSelect.appendChild(option);
            });
            districtSelect.disabled = false;

            if (districtName) {
              const selectedDistrict = districts.find(d => normalizeName(d.name) === normalizeName(districtName));
              if (selectedDistrict) {
                const res = await fetch(`https://provinces.open-api.vn/api/d/${selectedDistrict.code}?depth=2`);
                const data = await res.json();
                const wards = data.wards;
                const wardSelect = document.getElementById("ward");
                wardSelect.innerHTML = "<option disabled selected>-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>";
                wards.forEach(w => {
                  const option = document.createElement("option");
                  option.value = w.code;
                  option.text = w.name;
                  if (normalizeName(w.name) === normalizeName(wardName)) option.selected = true;
                  wardSelect.appendChild(option);
                });
                wardSelect.disabled = false;
              }
            }
          }
        }
      } catch (error) {
        alert("L·ªói c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ.");
      }
    }

    document.getElementById("province").addEventListener("change", e => {
      fetchDistricts(e.target.value);
      document.getElementById("ward").innerHTML = "";
      document.getElementById("ward").disabled = true;
    });

    document.getElementById("district").addEventListener("change", e => {
      fetchWards(e.target.value);
    });

    window.addEventListener("DOMContentLoaded", () => {
      fetchProvinces();
      renderProducts();
    });
  </script>

  <!-- ‚úÖ Nh√∫ng Google Maps API b·∫±ng callback -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeY4BfFKd71LsawFoCkPZZSPogULaLzEE&libraries=places&callback=initAutocomplete"></script>

</body>
</html>